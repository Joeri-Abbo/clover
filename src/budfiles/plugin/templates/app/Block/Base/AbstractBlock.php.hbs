<?php

namespace {{pascalcase namespace}}\Block\Base;

use Illuminate\Support\Collection;
use Psr\Container\ContainerInterface;
use {{pascalcase namespace}}\Asset\Contract\AssetInterface;
use {{pascalcase namespace}}\Block\Contract\BlockInterface;

/**
 * Block class.
 */
abstract class AbstractBlock extends \WP_Block_Type implements BlockInterface
{
    /** @var string */
    public $name;

    /** @var string */
    public $editor_script;

    /** @var string */
    public $editor_style;

    /** @var string */
    public $script;

    /** @var string */
    public $style;

    /** @var Collection */
    public $assets;

    /** @var Collection */
    public $attributes;

    /**
     * Constructor.
     *
     * @param Collection
     * @param ContainerInterface
     */
    public function __construct(
        Collection $collection,
        ContainerInterface $bud
    ) {
        $this->bud = $bud;
        $this->assets = $collection::make([]);
    }

    /**
     * Register block.
     *
     * @return void
     */
    public function register(): void
    {
        register_block_type($this);
    }

    /**
     * Get name.
     *
     * @return string
     */
    public function getName(): string
    {
        return $this->name;
    }

    /**
     * Set the block name.
     *
     * @param  string
     * @return void
     */
    public function setName(string $name): void
    {
        $this->name = "{$this->bud->get('plugin.namespace')}/{$name}";
    }

    /**
     * Get attributes.
     *
     * @return \Illuminate\Support\Collection
     */
    public function getAttributes(): Collection
    {
        return $this->attributes;
    }

    /**
     * Set attributes.
     *
     * @param  string $attributesPath
     * @return Block
     */
    public function setAttributes(Collection $attributes): void
    {
        $this->attributes = $attributes;
    }

    /**
     * Get assets.
     *
     * @return Collection
     */
    public function getAssets(): Collection
    {
        return $this->assets;
    }

    /**
     * Set editor asset
     *
     * @param  Asset
     * @return void
     */
    public function setEditorAsset(AssetInterface $asset): void
    {
        $this->assets->push($asset);

        $property = "editor_{$asset->getType()}";
        $this->{$property} = $asset->getName();
    }

    /**
     * Set public asset
     *
     * @param  string
     * @return void
     */
    public function setPublicAsset(AssetInterface $asset): void
    {
        $this->assets->push($asset);

        $this->{$asset->getType()} = $asset->getName();
    }
}
